commands:
  01_create_swap:
    command: |
      # 스왑 파일이 이미 존재하는지 확인
      if [ ! -f /swapfile ]; then
        echo "Creating 1GB swap file..."

        # 1GB 스왑 파일 생성 (fallocate 사용 - 더 빠름)
        fallocate -l 1G /swapfile || dd if=/dev/zero of=/swapfile bs=1M count=1024

        # 스왑 파일 권한 설정 (보안상 중요)
        chmod 600 /swapfile

        # 스왑 영역 설정
        mkswap /swapfile

        # 스왑 활성화
        swapon /swapfile

        # 부팅 시 자동 마운트를 위해 /etc/fstab에 추가 (중복 방지)
        if ! grep -q '/swapfile' /etc/fstab; then
          echo '/swapfile none swap sw 0 0' >> /etc/fstab
        fi

        echo "1GB swap file created successfully"
      else
        echo "Swap file already exists, skipping creation"
        swapon -s
      fi
    ignoreErrors: false
